<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./styles/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous" />
    <title>GPU Blog</title>
  </head>

  <body>
    <%- include('./partials/header.ejs') %>
    <%if(locals.obj){%><h1 style="text-align: center;"><%=obj[1] %><%}%>&nbsp;Posts</h1>
    <div class="parent-post-container">
      <% if(locals.obj[0] && obj[0].length!=0) { %> <% for(let i=0; i <
      obj[0].length; i++) {  %>
      <div class="post-container">
        <p style="text-decoration: none"
          ><div class="post-content"><%-obj[0][i]['title']%></div>
        </>
      </div>
      <% } %> <%} else{%>
      <div id="post-alternative">
        It's a ghost town üëª‚Äîno posts to see here! But keep scrolling! ‚è≥‚ú®
      </div>
      <%}%>
    </div>
    <%- include("./partials/footer.ejs") %>
  </body>
  <script>
      function linkerFn() {
        if(document.getElementById("post-alternative")) return;
        else {
          const linkers = document.querySelectorAll(".post-content");
          for(let linker of linkers) {
            linker.addEventListener("click", () => {
              fetch("/display-post", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({"title": linker.textContent,"category":document.querySelector("h1").textContent})
              }).then(response => response.text())
                .then(html => {
                    document.body.innerHTML = html;
                })
                .catch(error => console.error('Error fetching new page:', error));
            });
          }
        }
      }
      linkerFn();
      
    </script>
</html>
